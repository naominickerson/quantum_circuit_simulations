(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     32730,        797]
NotebookOptionsPosition[     32422,        782]
NotebookOutlinePosition[     32801,        798]
CellTagsIndexPosition[     32758,        795]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"BeginPackage", "[", "\"\<QSIM`stabilizers`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure4QGHZstabilizer", "::", "usage"}], "=", 
   "\"\<measure4QGHZstabilizer[ghzState,{pg,pm,pmem}] returns the state that \
describes the superoperator of a 4 qubit stabilizer measurement using a noisy \
ghzState with local error rates given by {pg,pm,pmem}. \>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"measure3QGHZstabilizer", "::", "usage"}], "=", 
    "\"\<measure3QGHZstabilizer[ghz_,{pg_,pm_,pmem_}] creates the \
superoperator STATE for a 3 body GHZ stabilizer using a given ghz state and \
with local error rates pg and pm.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"twirl4QGHZ", "::", "usage"}], "=", 
   "\"\<twirl4QGHZ[ghzState] returns a twirled version of ghzState\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"twirl3QGHZ", "::", "usage"}], "=", 
    "\"\<twirl3QGHZ[ghz] takes a density matrix of a noisy 3 qubit GHZ state \
and twirls it such that the noise is uniform over all three qubits.\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"measure4QRandomErrorsStabilizer", "::", "usage"}], " ", "=", " ", 
  "\"\<\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure3QRandomErrorsStabilizer", "::", "usage"}], " ", "=", " ", 
   "\"\<\>\""}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure4QancillaStabilizerLocal", "::", "usage"}], "=", 
   "\"\<produces superoperator STATE for a local ancilla 4 qubit stabilizer \
measurement\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"measure3QancillaStabilizerLocal", "::", "usage"}], "=", 
    "\"\<produces superoperator STATE for a local ancilla 3 qubit stabilizer \
measurement\>\""}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"qsim", "=", 
   RowBox[{"ParentDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_basicFunctions.m\>\""}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_measurement.m\>\""}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_noise.m\>\""}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Get", "[", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_superoperators.m\>\""}], "]"}],
    "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure4QGHZstabilizer", "[", 
    RowBox[{"ghz_", ",", 
     RowBox[{"{", 
      RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "input", ",", "state", ",", "cz1", ",", "cz2", ",", "cz3", ",", "cz4", 
       ",", "hads", ",", "meas", ",", "test", ",", "ident", ",", "noise1"}], 
      "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"KP", "[", 
         RowBox[{"ghz", ",", "phi0", ",", "phi0", ",", "phi0", ",", "phi0"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"12", ",", "1", ",", "5", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"12", ",", "2", ",", "7", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz3", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"12", ",", "3", ",", "9", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz4", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"12", ",", "4", ",", "11", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz1", ".", "state", ".", 
        RowBox[{"CT", "[", "cz1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz2", ".", "state", ".", 
        RowBox[{"CT", "[", "cz2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "2", ",", "7"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz3", ".", "state", ".", 
        RowBox[{"CT", "[", "cz3", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "3", ",", "9"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz4", ".", "state", ".", 
        RowBox[{"CT", "[", "cz4", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "4", ",", "11"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ident", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"IdentityMatrix", "[", "2", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"hads", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"KP", "[", 
         RowBox[{"had", ",", "had", ",", "had", ",", "had", ",", 
          RowBox[{"KP", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"ident", ",", "8"}], "]"}]}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"hads", ".", "state", ".", "hads"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"meas", "=", 
       RowBox[{"Chop", "@", 
        RowBox[{"SparseArray", "@", 
         RowBox[{"measureNQeven", "[", 
          RowBox[{"state", ",", "4", ",", "pm"}], "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"meas", "/", 
       RowBox[{"Tr", "[", "meas", "]"}]}]}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure3QGHZstabilizer", "[", 
    RowBox[{"ghz_", ",", 
     RowBox[{"{", 
      RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "input", ",", "state", ",", "cz1", ",", "cz2", ",", "cz3", ",", "cz4", 
       ",", "spHad", ",", "hads", ",", "meas"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"input", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"KP", "[", 
         RowBox[{"phi0", ",", "phi0", ",", "phi0"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"KP", "[", 
         RowBox[{"ghz", ",", "input"}], "]"}]}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "4", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "2", ",", "6", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz3", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "3", ",", "8", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz1", ".", "state", ".", 
        RowBox[{"CT", "[", "cz1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"applyGateNoise", "[", 
         RowBox[{"state", ",", "pg", ",", "1", ",", "4"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz2", ".", "state", ".", 
        RowBox[{"CT", "[", "cz2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "2", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz3", ".", "state", ".", 
        RowBox[{"CT", "[", "cz3", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "3", ",", "8"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"spHad", "=", 
       RowBox[{"SparseArray", "@", "had"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hads", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"KP", "[", 
         RowBox[{"spHad", ",", "spHad", ",", "spHad", ",", 
          RowBox[{"KP", "@@", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"SparseArray", "@", "id"}], ",", "6"}], "]"}]}]}], "]"}],
         "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"hads", ".", "state", ".", "hads"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"meas", "=", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"measureNQeven", "[", 
         RowBox[{"state", ",", "3", ",", "pm"}], "]"}]}]}], ";", " ", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"meas", "/", 
       RowBox[{"Tr", "[", "meas", "]"}]}]}]}], " ", "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"twirl4QGHZ", "[", "ghz_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "list", ",", "set1", ",", "set2", ",", "i", ",", "j"}], 
      "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", "ghz"}], ";", "\[IndentingNewLine]", 
      RowBox[{"list", "=", 
       RowBox[{"{", "state", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"set1", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"3", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"set2", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"2", ",", "3"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "4"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", "5"}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", 
           RowBox[{"i", "\[LessEqual]", "3"}], ",", 
           RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"state", "=", 
             RowBox[{"swapQubits", "[", 
              RowBox[{"state", ",", 
               RowBox[{
               "set1", "\[LeftDoubleBracket]", "i", 
                "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"list", "=", 
             RowBox[{"Join", "[", 
              RowBox[{"list", ",", 
               RowBox[{"{", "state", "}"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"state", "=", 
          RowBox[{"swapQubits", "[", 
           RowBox[{"state", ",", 
            RowBox[{
            "set2", "\[LeftDoubleBracket]", "j", "\[RightDoubleBracket]"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"list", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"list", ",", 
            RowBox[{"{", "state", "}"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", 
        RowBox[{"i", "\[LessEqual]", "3"}], ",", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"state", "=", 
          RowBox[{"swapQubits", "[", 
           RowBox[{"state", ",", 
            RowBox[{
            "set1", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}], 
           "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"list", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"list", ",", 
            RowBox[{"{", "state", "}"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Plus", "@@", "list"}], ")"}], "/", "24"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"twirl3QGHZ", "[", "ghz_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "list", ",", "set1", ",", "set2", ",", "i", ",", "j"}], 
      "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", "ghz"}], ";", "\[IndentingNewLine]", 
      RowBox[{"list", "=", 
       RowBox[{"{", "state", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"j", "=", "1"}], ",", 
        RowBox[{"j", "\[LessEqual]", "2"}], ",", 
        RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"state", "=", 
          RowBox[{"swapQubits", "[", 
           RowBox[{"state", ",", 
            RowBox[{"{", 
             RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"list", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"list", ",", 
            RowBox[{"{", "state", "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"state", "=", 
          RowBox[{"swapQubits", "[", 
           RowBox[{"state", ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", "3"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"list", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"list", ",", 
            RowBox[{"{", "state", "}"}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"swapQubits", "[", 
        RowBox[{"state", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"list", "=", 
       RowBox[{"Join", "[", 
        RowBox[{"list", ",", 
         RowBox[{"{", "state", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"(", 
        RowBox[{"Plus", "@@", "list"}], ")"}], "/", "6"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure4QRandomErrorsStabilizer", "[", 
    RowBox[{"{", 
     RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "ancilla", ",", "cz1", ",", "cz2", ",", "cz3", ",", "cz4",
        ",", "spid", ",", "hads"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", " ", "=", 
       RowBox[{"KP", "[", 
        RowBox[{"phi0", ",", "phi0", ",", "phi0", ",", "phi0"}], "]"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"apply", " ", "random", " ", "errors"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"applyRandomXZ", "[", 
        RowBox[{"state", ",", "1", ",", "pg"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", " ", 
       RowBox[{"applyRandomXZ", "[", 
        RowBox[{"state", ",", "3", ",", "pg"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"applyRandomXZ", "[", 
        RowBox[{"state", ",", "5", ",", "pg"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"applyRandomXZ", "[", 
        RowBox[{"state", ",", "7", ",", "pg"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"KP", "[", 
         RowBox[{"plus", ",", "state"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "2", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "4", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz3", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "6", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz4", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "8", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", 
       RowBox[{"cz1", ".", "state", ".", "cz1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", 
       RowBox[{"cz2", ".", "state", ".", "cz2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"cz3", ".", "state", ".", "cz3"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"cz4", ".", "state", ".", "cz4"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"spid", " ", "=", " ", 
       RowBox[{"SparseArray", "@", "id"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hads", " ", "=", " ", 
       RowBox[{"KP", "[", 
        RowBox[{
         RowBox[{"SparseArray", "@", "had"}], ",", "spid", ",", "spid", ",", 
         "spid", ",", "spid", ",", "spid", ",", "spid", ",", "spid", ",", 
         "spid"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"hads", ".", "state", ".", "hads"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"measureOutcomeReal", "[", 
        RowBox[{"state", ",", 
         RowBox[{"{", "0", "}"}], ",", "pm"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "/", 
       RowBox[{"Tr", "[", "state", "]"}]}]}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure3QRandomErrorsStabilizer", "[", 
    RowBox[{"{", 
     RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "ancilla", ",", "cz1", ",", "cz2", ",", "cz3", ",", "cz4",
        ",", "spid", ",", "hads"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", " ", "=", 
       RowBox[{"KP", "[", 
        RowBox[{"phi0", ",", "phi0", ",", "phi0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"apply", " ", "random", " ", "errors"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"applyRandomXZ", "[", 
        RowBox[{"state", ",", "1", ",", "pg"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", " ", 
       RowBox[{"applyRandomXZ", "[", 
        RowBox[{"state", ",", "3", ",", "pg"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"applyRandomXZ", "[", 
        RowBox[{"state", ",", "5", ",", "pg"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"KP", "[", 
         RowBox[{"plus", ",", "state"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"7", ",", "1", ",", "2", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"7", ",", "1", ",", "4", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz3", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"7", ",", "1", ",", "6", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", 
       RowBox[{"cz1", ".", "state", ".", "cz1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", 
       RowBox[{"cz2", ".", "state", ".", "cz2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"cz3", ".", "state", ".", "cz3"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"spid", " ", "=", " ", 
       RowBox[{"SparseArray", "@", "id"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hads", " ", "=", " ", 
       RowBox[{"KP", "[", 
        RowBox[{
         RowBox[{"SparseArray", "@", "had"}], ",", "spid", ",", "spid", ",", 
         "spid", ",", "spid", ",", "spid", ",", "spid"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"hads", ".", "state", ".", "hads"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", " ", "=", " ", 
       RowBox[{"measureOutcomeReal", "[", 
        RowBox[{"state", ",", 
         RowBox[{"{", "0", "}"}], ",", "pm"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "/", 
       RowBox[{"Tr", "[", "state", "]"}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure4QancillaStabilizerLocal", "[", 
    RowBox[{"{", 
     RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "ancilla", ",", "cz1", ",", "cz2", ",", "cz3", ",", "cz4",
        ",", "rotate", ",", "ident", ",", "measure"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ancilla", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "pm"}], ")"}], "*", "plus"}], "+", 
         RowBox[{"pm", "*", "minus"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"KP", "[", 
         RowBox[{
         "ancilla", ",", "phi0", ",", "phi0", ",", "phi0", ",", "phi0"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "carry", " ", "out", " ", "noisy", " ", "controlled", " ", "phase", 
        " ", "gates"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "2", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "4", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz3", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "6", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz4", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"9", ",", "1", ",", "8", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz1", ".", "state", ".", 
        RowBox[{"CT", "[", "cz1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz2", ".", "state", ".", 
        RowBox[{"CT", "[", "cz2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "4"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz3", ".", "state", ".", 
        RowBox[{"CT", "[", "cz3", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz4", ".", "state", ".", 
        RowBox[{"CT", "[", "cz4", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "8"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "measurement", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ident", "=", 
       RowBox[{"SparseArray", "@", "id"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"rotate", "=", 
       RowBox[{"KP", "[", 
        RowBox[{
         RowBox[{"SparseArray", "@", "had"}], ",", 
         RowBox[{"KP", "@@", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"ident", ",", "8"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"rotate", ".", "state", ".", 
        RowBox[{"CT", "[", "rotate", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"measure", "=", 
       RowBox[{"measureAncillaPlus", "[", 
        RowBox[{"state", ",", "pm"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"measure", "/", 
       RowBox[{"Tr", "[", "measure", "]"}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"measure3QancillaStabilizerLocal", "[", 
    RowBox[{"{", 
     RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "ancilla", ",", "cz1", ",", "cz2", ",", "cz3", ",", "cz4",
        ",", "rotate", ",", "ident", ",", "measure"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"ancilla", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"(", 
           RowBox[{"1", "-", "pm"}], ")"}], "*", "plus"}], "+", 
         RowBox[{"pm", "*", "minus"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"SparseArray", "@", 
        RowBox[{"KP", "[", 
         RowBox[{"ancilla", ",", "phi0", ",", "phi0", ",", "phi0"}], 
         "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "carry", " ", "out", " ", "noisy", " ", "controlled", " ", "phase", 
        " ", "gates"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"7", ",", "1", ",", "2", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"7", ",", "1", ",", "4", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz3", "=", 
       RowBox[{"twoQgateSparse", "[", 
        RowBox[{"7", ",", "1", ",", "6", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz1", ".", "state", ".", 
        RowBox[{"CT", "[", "cz1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz2", ".", "state", ".", 
        RowBox[{"CT", "[", "cz2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "4"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz3", ".", "state", ".", 
        RowBox[{"CT", "[", "cz3", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "measurement", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"ident", "=", 
       RowBox[{"SparseArray", "@", "id"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"rotate", "=", 
       RowBox[{"KP", "[", 
        RowBox[{
         RowBox[{"SparseArray", "@", "had"}], ",", 
         RowBox[{"KP", "@@", 
          RowBox[{"ConstantArray", "[", 
           RowBox[{"ident", ",", "6"}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"rotate", ".", "state", ".", 
        RowBox[{"CT", "[", "rotate", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"measure", "=", 
       RowBox[{"measureAncillaPlus", "[", 
        RowBox[{"state", ",", "pm"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"measure", "/", 
       RowBox[{"Tr", "[", "measure", "]"}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5959492412541385`*^9, 3.5959492943661385`*^9}, {
  3.5959493366301384`*^9, 3.5959493480071383`*^9}, {3.595949399582138*^9, 
  3.5959494236611385`*^9}, {3.5959494600061383`*^9, 3.595949508278138*^9}, {
  3.5959498262241383`*^9, 3.5959499518141384`*^9}, {3.5959499860511384`*^9, 
  3.5959499932251387`*^9}, {3.6064584336145024`*^9, 3.606458455070793*^9}, {
  3.6064585155418844`*^9, 3.606458551100995*^9}, {3.6064586000127754`*^9, 
  3.60645872675251*^9}, {3.6064587689197264`*^9, 3.606458798343669*^9}}]
},
AutoGeneratedPackage->Automatic,
WindowSize->{707, 537},
WindowMargins->{{Automatic, 157}, {-9, Automatic}},
FrontEndVersion->"8.0 for Microsoft Windows (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 31861, 760, 5292, "Input",
 InitializationCell->True]
}
]
*)

(* End of internal cache information *)
