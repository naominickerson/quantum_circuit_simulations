(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     23822,        576]
NotebookOptionsPosition[     23480,        560]
NotebookOutlinePosition[     23858,        576]
CellTagsIndexPosition[     23815,        573]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.59922025956123*^9, 3.5992202655598297`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<QSIMnonlocal`\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"singleSelection", "::", "usage"}], "=", 
   "\"\<singleSelection[rawPair,state,{pg,pm,pmem}]  takes a state, and a \
noisy bell pair (rawPair) and performs a noisy parity projection onto state \
with error rates pg,pm and pmem\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"singleParityProjectMap", "::", "usage"}], "=", 
   "\"\<singleParityProjectMap[bellPair_,{pg_,pm_,pmem_}] takes a 2 qubit \
density matrix representing a noisy bellPair and uses it to generate a \
superoperator describing a parity projection.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"doubleSelection", "::", "usage"}], "=", 
   "\"\<doubleSelection[bellPair1_,bellPair2_,inputState_,{pg_,pm_,pmem_}] \
uses two noisy bellPairs to perform a double selection parity projection on 2 \
qubit density matrix inputState given noise rates pg,pm and pmem.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"doubleParityProjectMap", "::", "usage"}], "=", 
   "\"\<doubleParityProjectMap[bell1,bell2,{pg,pm,pmem}]  creates a \
superorperator to describe the action of double selection parity projection \
using input bell pairs bell1 and bell2 with error rates pg,pm and \
pmem.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"czGateMap", "::", "usage"}], "=", 
   "\"\<czGateMap[bellPair,{pg,pm,pmem}] creates a superoperator describing a \
non-local controlled-Z gate performed on two qubits using a noisy bellPair \
with local error rates {pg,pm,pmem}. This superoperator can be applied to a \
density matrix using the applySuperoperator function\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"turnMap", "::", "usage"}], "=", 
    "\"\<turnMap[bellPair,{pg,pm,pmem}] creates a superoperator to perform a \
non-local 'turn' operation on two qubits using a noisy bellPair and local \
error rates {pg,pm,pmem}. The resulting superoperator can be applied to a \
state in density matrix form using the 'applySuperoperator' function\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"qsim", "=", 
   RowBox[{"ParentDirectory", "[", 
    RowBox[{"NotebookDirectory", "[", "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_basicFunctions.m\>\""}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_measurement.m\>\""}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Get", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_noise.m\>\""}], "]"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Get", "[", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"qsim", ",", "\"\<\\\\QSIM\\\\QSIM_superoperators.m\>\""}], "]"}],
    "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"singleSelection", "[", 
    RowBox[{"rawPair_", ",", "inputState_", ",", 
     RowBox[{"{", 
      RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "gate1", ",", "gate2", ",", "measure", ",", 
       "stateUpdate"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", 
       RowBox[{"KP", "[", 
        RowBox[{"rawPair", ",", "inputState"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gate1", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"4", ",", "1", ",", "3", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gate2", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"4", ",", "2", ",", "4", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "bilateral", " ", "gates", " ", "followed", " ", "by", " ", "noise"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"gate1", ".", "state", ".", 
        RowBox[{"CT", "[", "gate1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"gate2", ".", "state", ".", 
        RowBox[{"CT", "[", "gate2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "2", ",", "4"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"rotate", " ", "basis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{
        RowBox[{"KP", "[", 
         RowBox[{"had", ",", "had", ",", "id", ",", "id"}], "]"}], ".", 
        "state", ".", 
        RowBox[{"KP", "[", 
         RowBox[{"had", ",", "had", ",", "id", ",", "id"}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"measure", "=", 
       RowBox[{"Chop", "@", 
        RowBox[{"measure2even", "[", 
         RowBox[{"state", ",", "pm"}], "]"}]}]}], ";", "\n", 
      RowBox[{"stateUpdate", "=", 
       RowBox[{"measure", "/", 
        RowBox[{"Tr", "[", "measure", "]"}]}]}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"singleParityProjectMap", "[", 
    RowBox[{"rawPair_", ",", 
     RowBox[{"{", 
      RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "state", ",", "cz1", ",", "cz2", ",", "hadamards", ",", "measure", ",", 
       "result"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", 
       RowBox[{"KP", "[", 
        RowBox[{"rawPair", ",", "phi0", ",", "phi0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "1", ",", "3", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "2", ",", "5", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz1", ".", "state", ".", 
        RowBox[{"CT", "[", "cz1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz2", ".", "state", ".", 
        RowBox[{"CT", "[", "cz2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "2", ",", "5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"hadamards", "=", 
       RowBox[{"KP", "[", 
        RowBox[{
        "had", ",", "had", ",", "id", ",", "id", ",", "id", ",", "id"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"hadamards", ".", "state", ".", 
        RowBox[{"CT", "[", "hadamards", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"measure", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"measure2even", "[", 
         RowBox[{"state", ",", "pm"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"result", "=", 
       RowBox[{"measure", "/", 
        RowBox[{"Tr", "[", "measure", "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"createSuperoperator", "[", "result", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"doubleSelection", "[", 
    RowBox[{"bellPair1_", ",", "bellPair2_", ",", "inputState_", ",", 
     RowBox[{"{", 
      RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"state", ",", "cz1", ",", "cz2", ",", "measure", ",", "hads"}], 
      "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", 
       RowBox[{"KP", "[", 
        RowBox[{"bellPair2", ",", "bellPair1", ",", "inputState"}], "]"}]}], 
      ";", "           ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "3", ",", "5", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "4", ",", "6", ",", "cz"}], "]"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz1", ".", "state", ".", 
        RowBox[{"CT", "[", "cz1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz2", ".", "state", ".", 
        RowBox[{"CT", "[", "cz2", "]"}]}]}], ";", 
      "                                                            ", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "3", ",", "5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "4", ",", "6"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "1", ",", "3", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "2", ",", "4", ",", "cz"}], "]"}]}], ";", "  ", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz1", ".", "state", ".", 
        RowBox[{"CT", "[", "cz1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"cz2", ".", "state", ".", 
        RowBox[{"CT", "[", "cz2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "2", ",", "4"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"hads", "=", 
       RowBox[{"KP", "[", 
        RowBox[{
        "had", ",", "had", ",", "had", ",", "had", ",", "id", ",", "id"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"hads", ".", "state", ".", "hads"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"measure", "=", 
       RowBox[{"measure2even", "[", 
        RowBox[{
         RowBox[{"measure2even", "[", 
          RowBox[{"state", ",", "pm"}], "]"}], ",", "pm"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"measure", "/", 
        RowBox[{"Tr", "[", "measure", "]"}]}]}]}]}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"doubleParityProjectMap", "[", 
    RowBox[{"bell1_", ",", "bell2_", ",", 
     RowBox[{"{", 
      RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "input", ",", "state", ",", "cz1", ",", "cz2", ",", "cz3", ",", "cz4", 
       ",", "biCZ1", ",", "biCZ2", ",", "p", ",", "hadamards", ",", "measure",
        ",", "output"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"KP", "[", 
         RowBox[{"bell1", ",", "bell2", ",", "phi0", ",", "phi0"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"A1B1", "  ", "A2B2", "  ", 
        RowBox[{"A3A", "'"}], " ", 
        RowBox[{"B3B", "'"}]}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"cz1", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"8", ",", "4", ",", "7", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz2", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"8", ",", "3", ",", "5", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz3", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"8", ",", "1", ",", "3", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"cz4", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"8", ",", "2", ",", "4", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"biCZ1", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"cz1", ".", "cz2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"biCZ2", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"cz3", ".", "cz4"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"biCZ1", ".", "state", ".", 
        RowBox[{"CT", "[", "biCZ1", "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "4", ",", "7"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "3", ",", "5"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"biCZ2", ".", "state", ".", 
        RowBox[{"CT", "[", "biCZ2", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "1", ",", "3"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"applyGateNoise", "[", 
        RowBox[{"state", ",", "pg", ",", "2", ",", "4"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"SparseArray", "[", "state", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"hadamards", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"KP", "[", 
         RowBox[{"had", ",", "had", ",", "had", ",", "had", ",", 
          RowBox[{"IdentityMatrix", "[", 
           RowBox[{"2", "^", "4"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"hadamards", ".", "state", ".", 
        RowBox[{"CT", "[", "hadamards", "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"measure", "=", 
       RowBox[{"Chop", "[", 
        RowBox[{"measure2even", "[", 
         RowBox[{
          RowBox[{"measure2even", "[", 
           RowBox[{"state", ",", "pm"}], "]"}], ",", "pm"}], "]"}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"measure", "/", 
        RowBox[{"Tr", "[", "measure", "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"createSuperoperator", "[", "output", "]"}]}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"czGateMap", "[", 
    RowBox[{"bellPair_", ",", 
     RowBox[{"{", 
      RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "p", ",", "state", ",", "czA", ",", "czB", ",", "bilateralCZ", ",", 
       "aToX", ",", "bToY", ",", "rotate", ",", "measure", ",", "output", ",",
        "localgates"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"state", "=", 
       RowBox[{"KP", "[", 
        RowBox[{"bellPair", ",", "phi0", ",", "phi0"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"czA", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "1", ",", "3", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"czB", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{"6", ",", "2", ",", "5", ",", "cz"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"bilateralCZ", "=", 
       RowBox[{"czA", ".", "czB"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"bilateralCZ", ".", "state", ".", 
        RowBox[{"ConjugateTranspose", "[", "bilateralCZ", "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"applyGateNoise", "[", 
       RowBox[{"state", ",", "pg", ",", "1", ",", "3"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"applyGateNoise", "[", 
       RowBox[{"state", ",", "pg", ",", "2", ",", "5"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"rotate", " ", "to", " ", "measurement", " ", "bases"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"rotate", "=", 
       RowBox[{"KP", "[", 
        RowBox[{"had", ",", "hadY", ",", 
         RowBox[{"IdentityMatrix", "[", 
          RowBox[{"2", "^", "4"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"state", "=", 
       RowBox[{"rotate", ".", "state", ".", 
        RowBox[{"ConjugateTranspose", "[", "rotate", "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"measure", "=", 
       RowBox[{"Chop", "@", 
        RowBox[{"measure2even", "[", 
         RowBox[{"state", ",", "pm"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"measure", "/", 
        RowBox[{"Tr", "[", "measure", "]"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"localgates", "=", 
       RowBox[{"KP", "[", 
        RowBox[{
         RowBox[{"sm", ".", "pX"}], ",", "id", ",", "sm", ",", "id"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"output", "=", 
       RowBox[{"localgates", ".", "output", ".", 
        RowBox[{"CT", "[", "localgates", "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"createSuperoperator", "[", "output", "]"}]}]}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"turnMap", "[", 
   RowBox[{"bell_", ",", 
    RowBox[{"{", 
     RowBox[{"pg_", ",", "pm_", ",", "pmem_"}], "}"}]}], "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "state", ",", "cz1", ",", "cz2", ",", "biCZ", ",", "hadamards", ",", 
      "measure", ",", "gate1", ",", "mat", ",", "output"}], "}"}], ",", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"state", "=", 
      RowBox[{"KP", "[", 
       RowBox[{"bell", ",", "phi0", ",", "phi0"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"gate1", "=", 
      RowBox[{"KP", "[", 
       RowBox[{"sm", ",", "id", ",", "id", ",", "id", ",", "id", ",", "id"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"cz1", "=", 
      RowBox[{"twoQgate", "[", 
       RowBox[{"6", ",", "1", ",", "3", ",", "cnot"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"cz2", "=", 
      RowBox[{"twoQgate", "[", 
       RowBox[{"6", ",", "2", ",", "5", ",", "cy"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"biCZ", "=", 
      RowBox[{"cz1", ".", "cz2"}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"state", "=", 
      RowBox[{"gate1", ".", "state", ".", 
       RowBox[{"CT", "[", "gate1", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"state", "=", 
      RowBox[{"biCZ", ".", "state", ".", 
       RowBox[{"CT", "[", "biCZ", "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"state", "=", 
      RowBox[{"applyGateNoise", "[", 
       RowBox[{"state", ",", "pg", ",", "1", ",", "3"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"state", "=", 
      RowBox[{"applyGateNoise", "[", 
       RowBox[{"state", ",", "pg", ",", "2", ",", "5"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"hadamards", "=", 
      RowBox[{"KP", "[", 
       RowBox[{
       "had", ",", "had", ",", "id", ",", "id", ",", "id", ",", "id"}], 
       "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"state", "=", 
      RowBox[{"hadamards", ".", "state", ".", 
       RowBox[{"CT", "[", "hadamards", "]"}]}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"measure", "=", 
      RowBox[{"Chop", "[", 
       RowBox[{"measure2even", "[", 
        RowBox[{"state", ",", "pm"}], "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"mat", "=", 
      RowBox[{"KP", "[", 
       RowBox[{"pZ", ",", "id", ",", "id", ",", "id"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"state", "=", 
      RowBox[{"mat", ".", "measure", ".", "mat"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"output", "=", 
      RowBox[{"state", "/", 
       RowBox[{"Tr", "[", "state", "]"}]}]}], ";", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"createSuperoperator", "[", "output", "]"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{"End", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5959466079234443`*^9, 3.59594668275896*^9}, {
  3.5959467246217732`*^9, 3.5959467269475403`*^9}, {3.5959486930921383`*^9, 
  3.5959486984401383`*^9}, {3.5959490749731383`*^9, 3.5959491909281387`*^9}, {
  3.5992202898592596`*^9, 3.5992203154708204`*^9}, {3.5992203528965626`*^9, 
  3.59922036646692*^9}, {3.599220587049976*^9, 3.599220587162987*^9}, {
  3.599222393324585*^9, 3.599222407120965*^9}, {3.6064588074045744`*^9, 
  3.606458814927327*^9}}]
},
AutoGeneratedPackage->Automatic,
WindowSize->{707, 537},
WindowMargins->{{Automatic, 20}, {Automatic, 46}},
FrontEndVersion->"8.0 for Microsoft Windows (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 93, 1, 31, "Input"],
Cell[653, 23, 22823, 535, 4112, "Input",
 InitializationCell->True]
}
]
*)

(* End of internal cache information *)
