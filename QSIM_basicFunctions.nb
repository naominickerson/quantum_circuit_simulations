(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 8.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     40251,       1063]
NotebookOptionsPosition[     39943,       1048]
NotebookOutlinePosition[     40321,       1064]
CellTagsIndexPosition[     40278,       1061]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"BeginPackage", "[", "\"\<QSIM`basicfunctions`\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CT", "::", "usage"}], " ", "=", " ", 
  "\"\< conjugate transpose \>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KP", "::", "usage"}], " ", "=", " ", 
   "\"\< Kronecker product \>\""}], " "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Fidelity", "::", "usage"}], " ", "=", " ", 
  "\"\<Fidelity[\!\(\*SubscriptBox[\(\[Rho]\), \(1\)]\),\!\(\*SubscriptBox[\(\
\[Rho]\), \(\(2\)\(\\\ \)\)]\)] gives the fidelity of two density matrices \>\
\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Concurrence", "::", "usage"}], " ", "=", " ", 
   "\"\<Concurrence[\[Rho]] calculates the concurrence a measure of \
entanglement of a two qubit density matrix \[Rho]\>\""}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"phi0", "::", "usage"}], " ", "=", " ", 
  "\"\<density matrix of the perfect bell state Psi+: |00> + |11>\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plus", "::", "usage"}], " ", "=", " ", 
  "\"\<density matrix of the plus state |0> + |1> \>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"minus", "::", "usage"}], " ", "=", " ", 
  "\"\<density matrix of the minus state |0> - |1> \>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zero", "::", "usage"}], " ", "=", " ", 
  "\"\<density matrix of the zero state |0> \>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"one", "::", "usage"}], " ", "=", " ", 
  "\"\<density matrix of the one state |1> \>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bellState", "::", "usage"}], " ", "=", " ", 
  "\"\<bellState[i] where i =0,1,2,3 gives the four perfect bell \
states\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Rho]F", "::", "usage"}], " ", "=", " ", 
  "\"\<\[Rho]F[fidelity] gives a werner state of psi+\>\""}], "\
\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ghz", "::", "usage"}], " ", "=", " ", 
   "\"\<ghz[n] gives a perfect ghz state over n qubits\>\""}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pX", "::", "usage"}], " ", "=", " ", 
  "\"\<pauli x matrix\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pY", "::", "usage"}], " ", "=", " ", 
  "\"\<pauli y matrix\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pZ", "::", "usage"}], " ", "=", " ", 
  "\"\<pauli z matrix\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"id", "::", "usage"}], " ", "=", " ", 
  "\"\<identity matrix 1qubit\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"had", "::", "usage"}], " ", "=", " ", 
  "\"\<hadamard matrix\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"hadY", "::", "usage"}], " ", "=", " ", 
  "\"\<Y-hadamard matrix\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cz", "::", "usage"}], " ", "=", " ", 
  "\"\<two qubit CZ gate\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cnot", "::", "usage"}], " ", "=", " ", 
  "\"\<two qubit CNOT gate\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cnotB", "::", "usage"}], " ", "=", " ", 
  "\"\<two qubit CNOT gate in reverse direction\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cy", "::", "usage"}], " ", "=", " ", 
  "\"\<two qubit controlled-Y gate\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"swap", "::", "usage"}], " ", "=", " ", 
  "\"\<two qubit swap gate\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sm", "::", "usage"}], " ", "=", " ", 
   "\"\<phase gate, {{1,0},{0,i}}\>\""}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"projEvenMatrix", "::", "usage"}], " ", "=", " ", 
  "\"\<projEvenMatrix[n] creates the even projection matrix for n \
qubits\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"projOddMatrix", "::", "usage"}], "=", 
   "\"\<projOddMatrix[n] creates the odd projection matrix for n \
qubits\>\""}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"applyOneQubitGate", "::", "usage"}], "=", 
  "\"\<applyOneQubitGate[state,pos,gate,pg:1]\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"oneQgate", "::", "usage"}], " ", "=", " ", 
  "\"\<testoneQgate[dimension_,position_,gate_] creates a sparse matrix \
representing the gate where single qubit operation 'gate' is applied to the \
qubit at 'position'\>\""}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"twoQgate", "::", "usage"}], "=", "\[IndentingNewLine]", 
   "\"\<[V1.0] Proper usage example: twoQGate[5,2,4,mat] where mat is 4x4 \
matrix representing the two-qubit operation, total dimension of the qubit \
array is 2^5 (i.e. we have a 5 qubit array), first qubit involved in gate is \
number 2, second qubit involved is number 4. \nNote also: The lowest qubit \
label is 1 (not 0 as in c arrays), and the highest label is innermost level \
i.e. the comp basis is like |q1,q2,q3>. For large dimensions consider using \
the twoQgateSparse function instead.\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"twoQgateSparse", "::", "usage"}], "=", "\[IndentingNewLine]", 
   "\"\<twoQGateSparse[dimension,q1,q2,twoQubitGate], dimension is the total \
number of qubits, q1 and q1 are the qubits to be involved in the gate, and \
twoQubitGate is the operation to be applied to q1 and q2. The gate will \
always be applied to the qubits in their order q1-q2.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"swapQubits", "::", "usage"}], "=", 
   "\"\<swapQubits[state,{q1,q2}] takes a density matrix 'state' describing \
an arbitrary number of qubits and outputs a new density matrix where the \
qubits at positions q1 and q2 have been exchanged. For large system sizes \
consider using swapQubitsSparse\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"swapQubitsSparse", "::", "usage"}], "=", 
   "\"\<swapQubitsSparse[state,{q1,q2}] takes a density matrix 'state' \
describing an arbitrary number of qubits and outputs a new density matrix \
where the qubits at positions q1 and q2 have been exchanged.\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rearrangeQubits", "::", "usage"}], "=", 
   "\"\<rearrangeQubits[state,direction] takes arguments 'state' a density \
matrix and direction which is either 'F' (Forward) or 'B' (Back), and outputs \
a new density matrix where the qubits have been rearranged from e.g. \
(1,2,3,4,5,6) to (1,3,5 ,2,4,6) in the forward direction - or the opposite in \
the backwards direction. For large system sizes consider using \
rearrangeQubitsSparse\>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"rearrangeQubitsSparse", "::", "usage"}], "=", 
    "\"\<rearrangeQubitsSparse[state,direction] takes arguments 'state' a \
density matrix and direction which is either 'F' (Forward) or 'B' (Back), and \
outputs a new density matrix where the qubits have been rearranged from e.g. \
(1,2,3,4,5,6) to (1,3,5 ,2,4,6) in the forward direction - or the opposite in \
the backwards direction\>\""}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Begin", "[", "\"\<`Private`\>\"", "]"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CT", "[", "x_", "]"}], ":=", 
  RowBox[{"ConjugateTranspose", "[", "x", "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"KP", "[", "x__", "]"}], ":=", 
   RowBox[{"KroneckerProduct", "[", "x", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Fidelity", "[", 
    RowBox[{"a_", ",", "b_"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"Plus", "@@", 
      RowBox[{"(", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"Eigenvalues", "[", 
         RowBox[{"a", ".", "b"}], "]"}], "]"}], ")"}]}], ")"}], "^", "2"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Concurrence", "[", "rho_", "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "sigsigy", ",", "rhototal", ",", "rhototal2", ",", "Conc", ",", "g"}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"sigsigy", "=", 
        RowBox[{"KP", "[", 
         RowBox[{"pY", ",", "pY"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"rhototal", "=", "rho"}], ";", "\[IndentingNewLine]", 
       RowBox[{"rhototal2", "=", 
        RowBox[{"sigsigy", ".", 
         RowBox[{"(", 
          RowBox[{"Conjugate", "[", "rho", "]"}], ")"}], ".", "sigsigy"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"g", "=", 
        RowBox[{"Length", "[", 
         RowBox[{"Eigenvalues", "[", 
          RowBox[{"rhototal", ".", "rhototal2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Conc", "=", 
        RowBox[{
         SqrtBox[
          RowBox[{"Chop", "[", 
           RowBox[{
            RowBox[{"Eigenvalues", "[", 
             RowBox[{"rhototal", ".", "rhototal2"}], "]"}], "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]], "-", 
         RowBox[{
          UnderoverscriptBox["\[Sum]", 
           RowBox[{"i", "=", "2"}], "g"], 
          SqrtBox[
           RowBox[{"(", 
            RowBox[{"Chop", "[", 
             RowBox[{
              RowBox[{"Eigenvalues", "[", 
               RowBox[{"rhototal", ".", "rhototal2"}], "]"}], "[", 
              RowBox[{"[", "i", "]"}], "]"}], "]"}], ")"}]]}]}]}]}]}], 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Max", "[", 
       RowBox[{"{", 
        RowBox[{"0", ",", "Conc"}], "}"}], "]"}], "*)"}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"phi0", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["1", "2"], ",", "0", ",", "0", ",", 
       FractionBox["1", "2"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       FractionBox["1", "2"], ",", "0", ",", "0", ",", 
       FractionBox["1", "2"]}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"plus", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["1", "2"], ",", 
       FractionBox["1", "2"]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       FractionBox["1", "2"], ",", 
       FractionBox["1", "2"]}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"minus", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       FractionBox["1", "2"], ",", 
       RowBox[{"-", 
        FractionBox["1", "2"]}]}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1", "2"]}], ",", 
       FractionBox["1", "2"]}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"zero", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"one", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"bellState", "[", "i_", "]"}], ":=", 
  RowBox[{
   RowBox[{"ArrayFlatten", "[", 
    RowBox[{"Outer", "[", 
     RowBox[{"Times", ",", 
      RowBox[{"PauliMatrix", "[", "i", "]"}], ",", 
      RowBox[{"PauliMatrix", "[", "0", "]"}]}], "]"}], "]"}], ".", "phi0", 
   ".", 
   RowBox[{"ArrayFlatten", "[", 
    RowBox[{"Outer", "[", 
     RowBox[{"Times", ",", 
      RowBox[{"PauliMatrix", "[", "i", "]"}], ",", 
      RowBox[{"PauliMatrix", "[", "0", "]"}]}], "]"}], 
    "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"werner", "[", "f_", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"f", ",", 
    RowBox[{
     FractionBox["1", "3"], 
     RowBox[{"(", 
      RowBox[{"1", "-", "f"}], ")"}]}], ",", 
    RowBox[{
     FractionBox["1", "3"], 
     RowBox[{"(", 
      RowBox[{"1", "-", "f"}], ")"}]}], ",", 
    RowBox[{
     FractionBox["1", "3"], 
     RowBox[{"(", 
      RowBox[{"1", "-", "f"}], ")"}]}]}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"\[Rho]F", "[", "f_", "]"}], ":=", 
  RowBox[{"Plus", "@@", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"werner", "[", "f", "]"}], "\[LeftDoubleBracket]", "#", 
        "\[RightDoubleBracket]"}], "*", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"bellState", "[", "#", "]"}], "&"}], "/@", 
          RowBox[{"Range", "[", 
           RowBox[{"0", ",", "3"}], "]"}]}], ")"}], "\[LeftDoubleBracket]", 
        "#", "\[RightDoubleBracket]"}]}], "&"}], "/@", 
     RowBox[{"{", 
      RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}]}], 
    ")"}]}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ghz", "[", "n_", "]"}], ":=", 
   RowBox[{"KP", "@@", 
    RowBox[{"ConstantArray", "[", 
     RowBox[{
      RowBox[{"ReplacePart", "[", 
       RowBox[{
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", 
          RowBox[{"2", "^", "n"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"1", "\[Rule]", 
           RowBox[{"1", "/", 
            SqrtBox["2"]}]}], ",", 
          RowBox[{
           RowBox[{"2", "^", "n"}], "\[Rule]", 
           RowBox[{"1", "/", 
            SqrtBox["2"]}]}]}], "}"}]}], "]"}], ",", "2"}], "]"}]}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pX", "=", 
   RowBox[{"PauliMatrix", "[", "1", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pY", "=", 
   RowBox[{"PauliMatrix", "[", "2", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"pZ", "=", 
   RowBox[{"PauliMatrix", "[", "3", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"id", "=", 
    RowBox[{"PauliMatrix", "[", "0", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"had", "=", 
   RowBox[{
    FractionBox["1", 
     SqrtBox["2"]], 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"-", "1"}]}], "}"}]}], "}"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"hadY", "=", 
    RowBox[{
     FractionBox["1", 
      SqrtBox["2"]], 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"\[ImaginaryI]", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "\[ImaginaryI]"}], ",", "1"}], "}"}]}], "}"}]}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cz", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", 
       RowBox[{"-", "1"}]}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cnot", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"cnotB", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"cy", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "0", ",", 
        RowBox[{"-", "\[ImaginaryI]"}]}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "\[ImaginaryI]", ",", "0"}], "}"}]}], 
     "}"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"swap", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "0", ",", "1"}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"sm", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"1", ",", "0"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "\[ImaginaryI]"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"projEven", "[", "n_", "]"}], ":=", 
  RowBox[{"Join", "[", 
   RowBox[{
    RowBox[{"projEven", "[", 
     RowBox[{"n", "-", "1"}], "]"}], ",", 
    RowBox[{"Replace", "[", 
     RowBox[{
      RowBox[{"projEven", "[", 
       RowBox[{"n", "-", "1"}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"0", "\[Rule]", "1"}], ",", 
        RowBox[{"1", "\[Rule]", "0"}]}], "}"}], ",", "1"}], "]"}]}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"projEven", "[", "1", "]"}], ":=", 
  RowBox[{"{", 
   RowBox[{"1", ",", "0"}], "}"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"projOdd", "[", "n_", "]"}], ":=", 
  RowBox[{"Replace", "[", 
   RowBox[{
    RowBox[{"projEven", "[", "n", "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"0", "\[Rule]", "1"}], ",", 
      RowBox[{"1", "\[Rule]", "0"}]}], "}"}], ",", "1"}], 
   "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"projEvenMatrix", "[", "n_", "]"}], ":=", 
  RowBox[{"DiagonalMatrix", "[", 
   RowBox[{"projEven", "[", "n", "]"}], "]"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"projOddMatrix", "[", "n_", "]"}], ":=", 
   RowBox[{"DiagonalMatrix", "[", 
    RowBox[{"projOdd", "[", "n", "]"}], "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"applyOneQubitGate", "[", 
     RowBox[{"state_", ",", "pos_", ",", "gate_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"size", ",", "g", ",", "s"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"size", " ", "=", " ", 
        RowBox[{"Log", "[", 
         RowBox[{"2", ",", 
          RowBox[{"Length", "[", "state", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"g", "=", 
        RowBox[{"oneQgate", "[", 
         RowBox[{"size", ",", "pos", ",", "gate"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"s", " ", "=", " ", 
        RowBox[{"g", ".", "state", ".", 
         RowBox[{"CT", "[", "g", "]"}]}]}], ";", "\[IndentingNewLine]", 
       "s"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"oneQgate", "[", 
    RowBox[{"dimension_", ",", "position_", ",", "gate_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "sparseGate", ",", "ident", ",", "ident1", ",", "ident2", ",", "first", 
       ",", "second"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"position", ">", "dimension"}], "||", 
         RowBox[{"position", "<", "1"}], "||", 
         RowBox[{
          RowBox[{"Dimensions", "[", "gate", "]"}], "\[NotEqual]", 
          RowBox[{"{", 
           RowBox[{"2", ",", "2"}], "}"}]}]}], ",", 
        RowBox[{"Message", "[", 
         RowBox[{"oneQgate", "::", "usage"}], "]"}], ",", 
        RowBox[{"0", ";"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ident", "=", " ", 
       RowBox[{"SparseArray", "@", "id"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ident1", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"position", "\[Equal]", "1"}], ",", 
         RowBox[{"{", "1", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"position", "\[Equal]", "2"}], ",", "ident", ",", " ", 
           RowBox[{"KP", "@@", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"ident", ",", 
              RowBox[{"position", "-", "1"}]}], "]"}]}]}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ident2", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"position", "\[Equal]", "dimension"}], ",", 
         RowBox[{"{", "1", "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"position", "\[Equal]", 
            RowBox[{"dimension", "-", "1"}]}], ",", "ident", ",", 
           RowBox[{"KP", "@@", 
            RowBox[{"ConstantArray", "[", 
             RowBox[{"ident", ",", 
              RowBox[{"dimension", "-", "position"}]}], "]"}]}]}], "]"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"KP", "[", 
       RowBox[{"ident1", ",", 
        RowBox[{"SparseArray", "@", "gate"}], ",", "ident2"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"twoQgate", "[", 
    RowBox[{"d_", ",", "q1_", ",", "q2_", ",", "mat_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "size", ",", "first", ",", "secnd", ",", "miniMats", ",", "ident", ",", 
       "outMat"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"!", 
         RowBox[{"Element", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"d", ",", "q1", ",", "q2"}], "}"}], ",", "Integers"}], 
          "]"}]}], "||", 
        RowBox[{"q1", "\[GreaterEqual]", "q2"}], "||", " ", 
        RowBox[{"q2", ">", "d"}], "||", 
        RowBox[{"q1", "<", "1"}], "||", 
        RowBox[{
         RowBox[{"Dimensions", "[", "mat", "]"}], "\[NotEqual]", 
         RowBox[{"{", 
          RowBox[{"4", ",", "4"}], "}"}]}]}], ",", 
       RowBox[{
        RowBox[{"Message", "[", 
         RowBox[{"twoQgate", "::", "usage"}], "]"}], ";", "0"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"first", "=", 
         RowBox[{"Min", "[", 
          RowBox[{"q1", ",", "q2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"secnd", "=", 
         RowBox[{"Max", "[", 
          RowBox[{"q1", ",", "q2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"size", "=", 
         RowBox[{"secnd", "-", "first", "-", "1"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"size", ">", "0"}], ",", 
          RowBox[{"ident", "=", 
           RowBox[{"IdentityMatrix", "[", 
            RowBox[{"2", "^", "size"}], "]"}]}], ",", 
          RowBox[{"(*", "else", "*)"}], 
          RowBox[{"ident", "=", 
           RowBox[{"{", 
            RowBox[{"{", "1", "}"}], "}"}]}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"miniMats", "=", 
         RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
          RowBox[{
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{"ident", ",", 
             RowBox[{"mat", "[", 
              RowBox[{"[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"2", "*", "i"}], "-", "1"}], ";;", 
                 RowBox[{"2", "*", "i"}]}], ",", 
                RowBox[{
                 RowBox[{
                  RowBox[{"2", "*", "j"}], "-", "1"}], ";;", 
                 RowBox[{"2", "*", "j"}]}]}], "]"}], "]"}]}], "]"}], 
           "\[IndentingNewLine]", ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "2"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", "2"}], "}"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"outMat", "=", 
         RowBox[{"ArrayFlatten", "[", "miniMats", "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"first", ">", "1"}], ",", 
          RowBox[{"outMat", "=", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{
             RowBox[{"IdentityMatrix", "[", 
              RowBox[{"2", "^", 
               RowBox[{"(", 
                RowBox[{"first", "-", "1"}], ")"}]}], "]"}], ",", "outMat"}], 
            "]"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"secnd", "<", "d"}], ",", 
          RowBox[{"outMat", "=", 
           RowBox[{"KroneckerProduct", "[", 
            RowBox[{"outMat", ",", 
             RowBox[{"IdentityMatrix", "[", 
              RowBox[{"2", "^", 
               RowBox[{"(", 
                RowBox[{"d", "-", "secnd"}], ")"}]}], "]"}]}], "]"}]}]}], 
         "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        "outMat"}]}], "\[IndentingNewLine]", "]"}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"twoQgateSparse", "[", 
    RowBox[{"d_", ",", "q1_", ",", "q2_", ",", "mat_"}], "]"}], ":=", 
   "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "size", ",", "first", ",", "secnd", ",", "miniMats", ",", "ident", ",", 
       "outMat", ",", "ident2", ",", "sparseMat"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sparseMat", "=", 
       RowBox[{"SparseArray", "@", "mat"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"!", 
          RowBox[{"Element", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"d", ",", "q1", ",", "q2"}], "}"}], ",", "Integers"}], 
           "]"}]}], "||", 
         RowBox[{"q1", "\[GreaterEqual]", "q2"}], "||", " ", 
         RowBox[{"q2", ">", "d"}], "||", 
         RowBox[{"q1", "<", "1"}], "||", 
         RowBox[{
          RowBox[{"Dimensions", "[", "mat", "]"}], "\[NotEqual]", 
          RowBox[{"{", 
           RowBox[{"4", ",", "4"}], "}"}]}]}], ",", 
        RowBox[{
         RowBox[{"Message", "[", 
          RowBox[{"twoQgateSparse", "::", "usage"}], "]"}], ";", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"first", "=", 
          RowBox[{"Min", "[", 
           RowBox[{"q1", ",", "q2"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"secnd", "=", 
          RowBox[{"Max", "[", 
           RowBox[{"q1", ",", "q2"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"size", "=", 
          RowBox[{"secnd", "-", "first", "-", "1"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"ident2", "=", 
          RowBox[{"SparseArray", "@", 
           RowBox[{"IdentityMatrix", "[", "2", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"size", ">", "0"}], ",", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"size", ">", "1"}], ",", 
             RowBox[{"ident", "=", 
              RowBox[{"KP", "@@", 
               RowBox[{"ConstantArray", "[", 
                RowBox[{"ident2", ",", "size"}], "]"}]}]}], ",", 
             RowBox[{"ident", "=", "ident2"}]}], "]"}], ",", 
           RowBox[{"(*", "else", "*)"}], 
           RowBox[{"ident", "=", 
            RowBox[{"{", 
             RowBox[{"{", "1", "}"}], "}"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"miniMats", "=", 
          RowBox[{"Table", "[", "\[IndentingNewLine]", "\t", 
           RowBox[{
            RowBox[{"KP", "[", 
             RowBox[{"ident", ",", 
              RowBox[{"mat", "[", 
               RowBox[{"[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"2", "*", "i"}], "-", "1"}], ";;", 
                  RowBox[{"2", "*", "i"}]}], ",", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"2", "*", "j"}], "-", "1"}], ";;", 
                  RowBox[{"2", "*", "j"}]}]}], "]"}], "]"}]}], "]"}], 
            "\[IndentingNewLine]", ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2"}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "2"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"outMat", "=", 
          RowBox[{"SparseArray", "@", 
           RowBox[{"ArrayFlatten", "[", "miniMats", "]"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"first", ">", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"first", ">", "2"}], ",", "\[IndentingNewLine]", 
             RowBox[{"outMat", "=", 
              RowBox[{"KP", "[", 
               RowBox[{
                RowBox[{"KP", "@@", 
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{"ident2", ",", 
                   RowBox[{"first", "-", "1"}]}], "]"}]}], ",", "outMat"}], 
               "]"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"outMat", "=", 
              RowBox[{"KP", "[", 
               RowBox[{"ident2", ",", "outMat"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], "]"}], ";", "\[IndentingNewLine]",
          "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"secnd", "<", "d"}], ",", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"secnd", "<", 
              RowBox[{"d", "-", "1"}]}], ",", "\[IndentingNewLine]", 
             RowBox[{"outMat", "=", 
              RowBox[{"KP", "[", 
               RowBox[{"outMat", ",", 
                RowBox[{"KP", "@@", 
                 RowBox[{"ConstantArray", "[", 
                  RowBox[{"ident2", ",", 
                   RowBox[{"d", "-", "secnd"}]}], "]"}]}]}], "]"}]}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"outMat", "=", 
              RowBox[{"KP", "[", 
               RowBox[{"outMat", ",", "ident2"}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}]}], "]"}], ";", "\[IndentingNewLine]",
          "outMat"}]}], "\[IndentingNewLine]", "]"}]}]}], "]"}]}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"swapQubits", "[", 
    RowBox[{"state_", ",", 
     RowBox[{"{", 
      RowBox[{"q1_", ",", "q2_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "gate", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gate", "=", 
       RowBox[{"twoQgate", "[", 
        RowBox[{
         RowBox[{"Log", "[", 
          RowBox[{"2", ",", 
           RowBox[{"Length", "[", "state", "]"}]}], "]"}], ",", "q1", ",", 
         "q2", ",", "swap"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"gate", ".", "state", ".", "gate"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"swapQubitsSparse", "[", 
    RowBox[{"state_", ",", 
     RowBox[{"{", 
      RowBox[{"q1_", ",", "q2_"}], "}"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"gate", ",", "stateA"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"gate", "=", 
       RowBox[{"SparseArray", "[", 
        RowBox[{"twoQgate", "[", 
         RowBox[{
          RowBox[{"Log", "[", 
           RowBox[{"2", ",", 
            RowBox[{"Length", "[", "state", "]"}]}], "]"}], ",", "q1", ",", 
          "q2", ",", "swap"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"stateA", "=", 
       RowBox[{"SparseArray", "[", "state", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"gate", ".", "stateA", ".", "gate"}]}]}], "\[IndentingNewLine]",
     "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rearrangeQubits", "[", 
    RowBox[{"state_", ",", "fb_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dim", ",", "swaps", ",", "state2", ",", "n", ",", "test", ",", 
       "output"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dim", "=", 
       RowBox[{"Log", "[", 
        RowBox[{"2", ",", 
         RowBox[{"Length", "[", "state", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dim", "<", "3"}], ",", "state", ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"swaps", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{
               RowBox[{"2", "*", "i"}], "-", "1"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", 
              RowBox[{"dim", "/", "2"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"swaps", "=", 
          RowBox[{"Switch", "[", 
           RowBox[{
           "fb", ",", "\"\<F\>\"", ",", "swaps", ",", "\"\<B\>\"", ",", 
            RowBox[{"Reverse", "[", "swaps", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"state2", "=", "state"}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"n", "=", "1"}], ",", 
           RowBox[{"n", "<", 
            RowBox[{"(", 
             RowBox[{"dim", "/", "2"}], ")"}]}], ",", 
           RowBox[{"n", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"state2", "=", 
             RowBox[{"swapQubits", "[", 
              RowBox[{"state2", ",", 
               RowBox[{
               "swaps", "\[LeftDoubleBracket]", "n", 
                "\[RightDoubleBracket]"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "state2"}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"rearrangeQubitsSparse", "[", 
    RowBox[{"state_", ",", "fb_"}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "dim", ",", "swaps", ",", "state2", ",", "n", ",", "test", ",", 
       "output"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"dim", "=", 
       RowBox[{"Log", "[", 
        RowBox[{"2", ",", 
         RowBox[{"Length", "[", "state", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"dim", "<", "3"}], ",", "state", ",", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"swaps", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{
               RowBox[{"2", "*", "i"}], "-", "1"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "2", ",", 
              RowBox[{"dim", "/", "2"}]}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"swaps", "=", 
          RowBox[{"Switch", "[", 
           RowBox[{
           "fb", ",", "\"\<F\>\"", ",", "swaps", ",", "\"\<B\>\"", ",", 
            RowBox[{"Reverse", "[", "swaps", "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"state2", "=", 
          RowBox[{"SparseArray", "[", "state", "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"n", "=", "1"}], ",", 
           RowBox[{"n", "<", 
            RowBox[{"(", 
             RowBox[{"dim", "/", "2"}], ")"}]}], ",", 
           RowBox[{"n", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"state2", "=", 
             RowBox[{"swapQubitsSparse", "[", 
              RowBox[{"state2", ",", 
               RowBox[{
               "swaps", "\[LeftDoubleBracket]", "n", 
                "\[RightDoubleBracket]"}]}], "]"}]}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
         "state2"}]}], "\[IndentingNewLine]", "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"End", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"EndPackage", "[", "]"}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.5959415962256775`*^9, 3.595941730519106*^9}, {
   3.595942139042954*^9, 3.595942603709149*^9}, {3.595942655420149*^9, 
   3.595942836123149*^9}, {3.595942881773149*^9, 3.595942927221149*^9}, {
   3.595942978215149*^9, 3.595942996207149*^9}, {3.5959430835661488`*^9, 
   3.595943132405149*^9}, {3.595943171431149*^9, 3.595943216817149*^9}, {
   3.5959432740471487`*^9, 3.5959433605061493`*^9}, {3.595944278434886*^9, 
   3.5959442847495174`*^9}, 3.5959443359966416`*^9, 3.595944385506592*^9, {
   3.5959473258141384`*^9, 3.5959473416781387`*^9}, 3.5959474081101384`*^9, {
   3.5964488273499937`*^9, 3.596448841484994*^9}, {3.5964489319369936`*^9, 
   3.596448977168994*^9}, 3.596449071312994*^9, {3.5964491089293675`*^9, 
   3.596449120449519*^9}, {3.6060501499484463`*^9, 3.6060502856870184`*^9}, {
   3.6060503285773067`*^9, 3.606050328998349*^9}}]
},
AutoGeneratedPackage->Automatic,
WindowSize->{696, 537},
WindowMargins->{{Automatic, 46}, {Automatic, -2}},
FrontEndVersion->"8.0 for Microsoft Windows (64-bit) (February 23, 2011)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 39382, 1026, 5821, "Input",
 InitializationCell->True]
}
]
*)

(* End of internal cache information *)
